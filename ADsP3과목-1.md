# ADsP 3과목-1(R기초,  데이터 가공)

### **1장- 1 데이터 분석 기법의 이해**

- 데이터 처리 과정
- 시각화 기법
- 공간분석
- **탐색적 자료분석 :** 데이터가 가지고 있는 특성을 파악하기 위해 시각화하여 분석하는 방식
- EDA의 4가지 주제 : **저항성의 강조, 잔차 계산, 자료변수의 재표현, 그래프를 통한 현시성**
- 통계분석 : 한눈에 알아보기 쉽게 숫자와 표, 그림의 형태로 나타내는 것(기술통계, 추론통계)
- **데이터 마이닝** : 대규모로 저장된 데이터 안에서 체계적이고 자동적으로 통계적 규칙이나 패턴을 분석하여 가치있는 정보를 추출하는 과정

### **2장-1 R소개**

- 오픈 소스 프로그램으로 통계, 데이터마이닝과 그래프를 위한 언어이다.
- 특징
- 오픈소스 프로그램
- 뛰어난 그래픽 및 성능
- 시스템 데이터 저장 방식
- 모든 운영체제에서 사용 가능
- S언어 기반
- 객체 지향 언어이면서 함수형 언어

### **2장-2 R 기초**

- 벡터 생성 c: c(1,2,3)은 [1 2 3]이고 숫자형 벡터이지만 c(1,2,‘a’)처럼 문자형이 원소로

하나라도 껴있으면 문자형 벡터가 됨

- 패키지 설치 및 로드 : install.packages(“패키지명”) → library(패키지명)
1. 변수 다루기
- R에서는 변수명을 선언하고 값을 할당하면 자료형태를 스스로 선언한다.
- 화면에 프린트할 때는 print()를 사용해도 되지만 변수 값만 표현해도 내용을 출력한다.
- 변수에 값을 할당할 때는 **“<-”**를 주로 사용한다.
- ls() : 불필요한 변수 확인 / rm() : 변수 삭제
1. 통계량 계산

mean() : 평균 / median() : 중간값 / sd() : 표준표차

var() : 분산 / cov() : 공분산 / cor() : 상관계수

### **2장-3 R 입력과 출력**

- R에서는 텍스트 데이터 뿐만 아니라 데이터베이스와 다양한 통계프로그램에서 작성된 데이터를 불러들여서 적절한 데이터분석을 수행
- R에서는 부동소수점 표현시 7자리 수를 기본으로 셋팅(option()함수와 digit="숫자“를 지정해서 자릿수를 변경할 수 있음.
- 문자열을 파일로 저장할 때 : cat("저장할 문자열". file="파일명“)
- R에서는 \를 인식 못하므로 / 또는 \\로 파일의 경로를 지정
- 

### **2장-4 R 데이터 구조**

- 행렬 설정 : dim(vec) <- c(2,3)
1. 데이터 구조 변환
- 벡터 -> 리스트 : as.list(vec) / 벡터 -> 행렬 : 1열 - as.matrix(vec), 1행 - rbind(vec)
- 행렬 -> 리스트 : as.list(mat) / 리스트 -> 행렬 : 1열 - as.matrix(lst), 1행 - as.matrix(rbind(lst))
- 데이터프레임 -> 리스트 : as.list(dfm) / 데이터프레임 -> 행렬 : as.matrix(dfm)
- 벡터 -> 데이터프레임 : as.data.frame(vec), as.data.frame(rbind(vec))
- 리스트 -> 데이터프레임 : as.data.frame(lst), rbind(obs[[1]],obs[[2]])
- 행렬 -> 데이터프레임 : as.data.frame(mat)
- 리스트 -> 벡터 : unlist(lst) / 행렬 -> 벡터 : as.vector(mat) / 데이터프레임 -> 벡터 : dfm[[1]], dfm[1]
1. 집단으로 데이터 분할하기
- 벡터 : split(vec,fac) - 벡터값과 펙터값의 길이가 같아야함.
- 데이터프레임 : split(dfm,fac)
1. 함수 적용하기
- 벡터, 행렬 : apply(mtr,1,func), apply(mtr,2,func)
- 리스트 : lapply(lst,func), sapply(lst,func)
- 데이터프레임 : lapply(dfm,func), sapply(dfm,func), apply(dfm,1or2,func)
1. 문자열 다루기
- 문자열의 길이 : nchar("문자열“) / 벡터의 길이 : length(vec) / 문자열 연결하기 : paste("단어”, “문장”, "scalar")

하위 문자열 추출하기 : substr("문자열“, 시작번호, 끝번호) / 구분자로 문자열 추출하기 : strsplit("문자열”, 구분자)

문자열 대체하기 : sub("대상문자열“,”변경문자열“,s), gsub("대상문자열”,“변경문자열”,s)

1. 날짜 다루기
- 문자열 -> 날짜 : as.Date('2022-02-02")
- 날짜 -> 문자열 : format(Sys.Date(), format="%m/%d/%Y")
- format 인자값

%b ; 축약된 월 이름("Jan") / %B : 전체 월 이름("January") / %d : 두자리 숫자로 된 일(“31”)

%m : 두자리 숫자로 된 월(“12”) / %y : 두자리 숫자로 된 년(“22”) / %Y : 네자리 숫자로 된 년(“2022”)

EX)

- 행렬을 as.vector함수에 입력하면 열방향으로 1열부터 원소를 나열하는 벡터 생성. 예를 들어 행렬이 있다면 as.vector 함수에 넣으면 [1 2 3 4]가 됨(열방향으로! 행방향 아님)
- 만약 [1 2] + [3 4 5 6 7]를 하게되면 상식적으로는 계산이 불가하지만 R에서는 가능함

[3+1 4+2 5+1 6+2 7+1] 와 같이 연산됨(경고메세지와 함께 출력) 부족한 벡터성분을 짧은 벡터의 원소([1 2])를 재활용해가면서 사용.

- **summary함수는 4분위수, 최소, 최대, 중앙값, 평균을 출력함**
- **데이터프레임**: 2차원 목록(list) 데이터 구조, 각 열이 다른 데이터 타입을 가질 수 있다.

⤷ 데이터 테이블: 데이터 프레임과 유사하지만 보다 월등히 빠른 grouping과 ordering, 짧은 문장 지원측 면에서 더 매력적

- na.rm=T 는 na이가 not answer(결측값) rm이 remove(삭제) T가 True라 생각하면 결측

값을 삭제하라는 뜻으로 생각. ⤷mean(x,na.rm=T)는 결측값을 제외한 x의 평균이라는 뜻

### **3장-1 R 데이터 변경 및 요약**

- **데이터마트**

데이터 웨어하우스와 사용자 사이의 중간층에 위치한 것으로, 하나의 주제 또는 하나의 부서 중심의 데이터 웨어하우스라고 할 수 있음

데이터마트 내 대부분의 데이터는 데이터 웨어하우스로부터 복제되지만, 자체적으로 수집될수도 있으며, 관계형 데이터베이스나 다차원 데이터베이스를 이용해 구축한다

- CRM 관련 업무 중에서 핵심 - 고객 데이터 마트 구축
- 동일한 데이터셋을 활용할 경우, 최신 분석기법들을 이용하면 분석가의 역량에서는 분석 효과가 크게 차이 나지 않기 때문에 **데이터 마트를 어떻게 구축하느냐에 따라 분석효과가 크게 차이 남**
1. **요약변수** : 수집된 정보를 분석에 맞게 종합한 변수
    - 데이터마트에서 가장 기본적인 변수로, 총구매 금액, 금액, 횟수, 구매여부 등 데이터 분석을 위해 만들어지는 변수임
    - 많은 모델을 공통으로 사용될 수 있어 재활용성이 높음
    - 간단한 구조이므로 자동화하여 상황에 맞게 사용
    - 단점 : 얼마 이상이면 구매하더라도 기준값의 의미해석이 애매할 수 있음 → 연속형변수를 그룹핑해 사용하기
    - ex. 기간별 구매금액, 횟수 여부, 위클리 쇼퍼, 상품별 구매순서, 단어빈도, 초기 행동변수, 트렌드 변수, 결측값과 이상값 처리, 연속형 변수의 구간화, 유통 채널별 구매 금액 등
2. **파생변수** : 사용자가 특정 조건을 만족하거나 특정 함수에 의해 값을 만들어 의미를 부여한 변수
    - 매우 주관적일 수 있으므로 논리적 타당성을 갖추어 개발해야 됨
    - 세분화, 고객행동 예측, 캠페인 반응 예측에 매우 잘 활용됨
    - 특정 상황에만 유의미하지 않고 대표성을 나타낼 수 있도록 함
    - ex. 근무시간 구매지수, 주 구매매장 변수, 주 활동지역 변수, 구매상품 다양성 변수, 라이프스타일 변수, 행사민감 변수, 최대가치 변수, 최적 통화시간, 휴면가망 변수 등
    
    ### **reshape**
    
    reshape 패키지에는 `melt()` 와 `cast()` 라는 2개의 핵심함수가 있음
    
    - `melt()` : **원데이터** 형태로 만드는 함수
    - `cast()` : **요약** 형태로 만드는 함수
    
    ```r
    cast(md, id + variable ~ time)
    aqm <- melt(airquality, id=c("Month", "Day"), na.rm=TRUE)
    ddply(chickwts, ~feed, summarize, groupmean=mean(weight))
    ```
    
    ### sqldf
    
    sqldf는 R에서 sql 의 명령어를 사용가능하게 해주는 패키지
    
    - head([df]) : sqldf("select * from [df] limit 6")
    - subset([df]) : sqldf("select * from [df] where [col] in ('BF', 'HF')")
    - merge([df1], [df2]) : sqldf("select * from [df1], [df2]")
    
    ### **plyr**
    
    apply 기반으로 데이터와 출력변수를 동시에 배열로 치환하여 처리하는 패키지
    
    ### data.table
    
     R에서 가장 많이 사용하는 핸들링 패키지 중 하나로 대용량 데이터의 탐색, 연산, 병합에 유용함.
    
    ### 결측값
    
    `na.rm` 을 이용해 NA를 제거할 수 있음
    
    `complete.cases()` : 데이터내 레코드에 결측값이 있으면 FALSE, 없으면 TRUE 
    
    `is.na()` : 결측값을 NA로 인식해 결측값이 있으면 TRUE, 없으면 FALSE
    
    `knnImputation()` : NA값을 k최근 이웃분류 알고리즘을 사용해 대치하는 것으로, k개 주변 이웃까지의 거리를 고려해 가중 평균한 값을 대치해주는 함수
    
    `rfImpute()` : 랜덤포레스트 모형은 결측값이 있으면 에러가 발생하기 때문에 랜덤포레스트 패키지에서 NA 결측값을 대치하도록 하는 함수
    
    - **completes analysis** : 결측값이 존재하는 레코드를 **삭제**한다
        
        → 부분적 관측자료를 사용하므로 통계적 추론의 타당성 문제가 있음
        
    - **평균대치법** : 데이터의 **평균**으로 대치한다
        - 비조건부 평균 대치법 : 관측데이터의 평균으로 대치
        - 조건부 평균 대치법 : 회귀분석을 활용한 대치법
    - **단순확률 대치법** : 평균대치법에서 추정량 평균 오차의 과소 추정문제를 보완하고자 고안된 방법으로 **Hot-deck** 방법, K-**nearest neighbor** 방법 등이 있음
    - **다중대치법** : 단순대치법 한번 X → m개의 대치를 통해 m개의 가상적 완전 자료를 만드는 방법
        - (1) 대치 → (2) 분석 → (3) 결합
    
    ### 이상값
    
    이상값을 꼭 제거해야 하는 것은 아니기 때문에 분석의 목적이나 종류에 따라 적절한 판단이 필요함
    
    데이터를 분석할 때 이상치는 다른 이유나 중요한 요인이 될 수 있으므로함부로 삭제하면 안된다.
    
    - **이상값 인식방법**
        1. **ESD(Extreme Studentized Deviation)** : 평균으로부터 **3 표준편차** 떨어진 값 **99.7%** (각 0.15)
        2. 기하평균 - (2.5 x 표준편차) < **data** < 기하평균 + (2.5 x 표준편차)
        3. 사분위수 이용해 제거 (상자 그림의 outer fence 밖에 있는 값 제거)
            
            **Q1 - 1.5(Q3 - Q1) < data < Q3 + 1.5(Q3 - Q1)**           *IQR = Q3 - Q1
            
    - **극단값 절단 방법**
        1. 기하평균 이용한 제거 : geo_mean
        2. 하단, 상단 % 이용한 제거 : 상하위 5%, 즉 총 10% 데이터 제거
    - 극단값 조정 방법
        
        상한값과 하한값을 벗어나는 값들을 하한, 상한값으로 바꾸어 화룡하는 방법
        
    - ex. 사기탐지, 의료, 침입탐지, 부정사용방지 시스템
    - **군집분석**을 이용해 다른 데이터들과 거리상 멀리 떨어진 데이터를 이상치로 판정
    - 설명변수의 관측치에 비해 종속변수의 값이 상이한 값을 이상치라 함
    - 이상치는 분포를 왜곡할 수 있으나 실제 오류인자에 대해서는 통계적으로 실행하지 못하기 때문에 제거 여부는 실무자들을 통해 결정하는 것이 바람직함
